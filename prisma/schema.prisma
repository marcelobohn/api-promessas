generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum ElectionType {
  FEDERAL_ESTADUAL
  MUNICIPAL
}

model Candidate {
  id               Int             @id @default(autoincrement())
  name             String
  politicalPartyId Int?            @map("political_party_id")
  politicalParty   PoliticalParty? @relation(fields: [politicalPartyId], references: [id], onDelete: SetNull)
  electionId       Int?            @map("election_id")
  election         Election?       @relation(fields: [electionId], references: [id], onDelete: SetNull)
  officeId         Int             @map("office_id")
  office           Office          @relation(fields: [officeId], references: [id], onDelete: Restrict)
  createdAt        DateTime        @default(now()) @map("created_at")
  updatedAt        DateTime        @updatedAt @map("updated_at")
  promises         Promise[]

  @@map("candidates")
}

model Election {
  id          Int          @id @default(autoincrement())
  year        Int          @unique
  description String?
  active      Boolean      @default(true) @map("is_active")
  type        ElectionType @default(FEDERAL_ESTADUAL) @map("election_type")
  createdAt   DateTime     @default(now()) @map("created_at")
  updatedAt   DateTime     @updatedAt @map("updated_at")
  candidates  Candidate[]

  @@map("elections")
}

enum PromiseStatus {
  NOT_STARTED
  IN_PROGRESS
  COMPLETED
}

model Promise {
  id          Int              @id @default(autoincrement())
  title       String
  description String?
  status      PromiseStatus    @default(NOT_STARTED)
  progress    Int              @default(0)
  candidateId Int              @map("candidate_id")
  candidate   Candidate        @relation(fields: [candidateId], references: [id], onDelete: Cascade)
  comments    PromiseComment[]
  createdAt   DateTime         @default(now()) @map("created_at")
  updatedAt   DateTime         @updatedAt @map("updated_at")

  @@map("promises")
}

model PromiseComment {
  id        Int      @id @default(autoincrement())
  content   String
  promiseId Int      @map("promise_id")
  promise   Promise  @relation(fields: [promiseId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now()) @map("created_at")

  @@map("promise_comments")
}

model Office {
  id          Int          @id @default(autoincrement())
  name        String       @unique
  description String?
  type        ElectionType @default(FEDERAL_ESTADUAL) @map("office_type")
  candidates  Candidate[]

  @@map("offices")
}

model PoliticalParty {
  id         Int         @id @default(autoincrement())
  acronym    String      @unique
  number     Int         @unique
  name       String
  createdAt  DateTime    @default(now()) @map("created_at")
  updatedAt  DateTime    @updatedAt @map("updated_at")
  candidates Candidate[]

  @@map("political_parties")
}

model State {
  codigoUf    Int      @id @map("codigo_uf")
  name        String
  abbreviation String  @unique
  cities      City[]

  @@map("states")
}

model City {
  id        Int      @id @default(autoincrement())
  ibgeCode  Int      @unique @map("ibge_code")
  name      String
  stateCode Int      @map("state_code")
  state     State    @relation(fields: [stateCode], references: [codigoUf], onDelete: Cascade)

  @@unique([name, stateCode])
  @@map("cities")
}
